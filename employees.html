
<!DOCTYPE html>
<html lang="en">
<head>
<!-- ðŸ” Secure .env Configuration Loader -->
    <script src="env-config-loader.js"></script>



  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Employee Management, Ranking & Payments</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"/>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.datatables.net/1.11.5/css/dataTables.bootstrap5.min.css" rel="stylesheet">
  <style>
    :root {
      --primary-color: #2E8B57; /* A deep sea green, matching route-details */
      --present-color: #198754; /* Bootstrap Green */
      --absent-color: #dc3545; /* Bootstrap Red */
      --halfday-color: #ffc107; /* Bootstrap Yellow */
      --gold-color: #FFD700;
      --silver-color: #C0C0C0;
      --bronze-color: #CD7F32;
    }
    body { 
      padding: 0; 
      margin: 0; 
      background-color: #f8f9fa; 
      font-family: 'Inter', sans-serif;
    }
    .main-content {
      background: white;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.05);
    }
    .form-section {
      background-color: #f8f9fa;
      padding: 20px;
      border-radius: 8px;
      margin-bottom: 20px;
      border: 1px solid #dee2e6;
    }
    .nav-tabs .nav-link.active {
      background-color: var(--primary-color);
      color: white;
      border-color: var(--primary-color);
    }
    .nav-tabs .nav-link {
      color: var(--primary-color);
    }
    
    /* Attendance Calendar Styles */
    .attendance-calendar-container {
      border: 1px solid #dee2e6;
      border-radius: 8px;
      padding: 15px;
      background-color: #fff;
    }
    .attendance-grid {
      display: grid;
      grid-template-columns: 200px repeat(7, 1fr); /* Employee Name + 7 Days */
      gap: 1px;
      border: 1px solid #eee;
      background-color: #eee;
    }
    .grid-cell {
      background-color: white;
      padding: 8px 5px;
      text-align: center;
      font-weight: 500;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .grid-header {
      background-color: #f8f9fa;
      font-weight: bold;
      color: #333;
      padding: 10px 5px;
    }
    .grid-cell.employee-name {
      text-align: left;
      font-weight: 600;
      background-color: #f8f9fa;
      position: sticky;
      left: 0;
      z-index: 10;
      border-right: 1px solid #eee;
    }
    .status-badge {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 28px;
      height: 28px;
      border-radius: 50%;
      font-size: 0.8rem;
      font-weight: bold;
      cursor: pointer;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
      transition: all 0.2s;
    }
    .status-P { background-color: var(--present-color); color: white; }
    .status-A { background-color: var(--absent-color); color: white; }
    .status-H { background-color: var(--halfday-color); color: #333; }
    .status-L { background-color: #0d6efd; color: white; } /* Leave */

    /* Ranking Award Styles */
    .award-icon {
        margin-right: 5px;
        font-size: 1.1em;
    }
    .rank-1 { color: var(--gold-color); }
    .rank-2 { color: var(--silver-color); }
    .rank-3 { color: var(--bronze-color); }

    /* Table alignment fixes */
    #employeeRankingTable {
      table-layout: fixed !important;
      width: 100% !important;
    }
    #employeeRankingTable th,
    #employeeRankingTable td {
      padding: 8px 12px;
      vertical-align: middle;
    }
    #employeeRankingTable .text-start {
      text-align: left !important;
    }
    #employeeRankingTable .text-end {
      text-align: right !important;
    }
    #employeeRankingTable .text-center {
      text-align: center !important;
    }
    #employeeRankingTable td:first-child {
      max-width: 300px;
      word-wrap: break-word;
      white-space: normal;
    }
    #employeeRankingTable td:last-child {
      white-space: nowrap;
      min-width: 120px;
    }
    .table-responsive {
      overflow-x: auto;
    }
  </style>
</head>
<body>
  <div id="navbar-placeholder"></div>

  <div class="container mt-4">
    <div class="main-content">
      <h2 class="mb-4"><i class="fas fa-users-cog me-2" style="color: var(--primary-color);"></i>Employee Management</h2>

      <ul class="nav nav-tabs" id="employeeTabs" role="tablist">
        <li class="nav-item" role="presentation">
          <button class="nav-link active" id="employees-ranking-tab" data-bs-toggle="tab" data-bs-target="#employeesRanking" type="button" role="tab">
            <i class="fas fa-list-ol me-1"></i> Employee List & LR Ranking
          </button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="attendance-tab" data-bs-toggle="tab" data-bs-target="#attendanceView" type="button" role="tab">
              <i class="fas fa-calendar-check me-1"></i> Attendance Calendar
            </button>
        </li>
        <li class="nav-item" role="presentation">
          <button class="nav-link" id="payments-tab" data-bs-toggle="tab" data-bs-target="#payments" type="button" role="tab">
            <i class="fas fa-money-check-alt me-1"></i> Record Salary Payment
          </button>
        </li>
      </ul>

      <div class="tab-content pt-3" id="employeeTabsContent">

        <div class="tab-pane fade show active" id="employeesRanking" role="tabpanel" aria-labelledby="employees-ranking-tab">

          <form id="employeeForm" class="form-section">
            <h4 class="mb-3">Add/Edit Employee</h4>
            <input type="hidden" id="employeeIdHidden">
            <div class="row">
              <div class="col-md-3 mb-3">
                <label for="employeeName" class="form-label">Name <span class="text-danger">*</span></label>
                <input type="text" id="employeeName" class="form-control rounded" required>
              </div>
              <div class="col-md-3 mb-3">
                <label for="employeeDesignation" class="form-label">Designation <span class="text-danger">*</span></label>
                <input type="text" id="employeeDesignation" class="form-control rounded" required>
              </div>
              <div class="col-md-3 mb-3">
                <label for="employeeSalary" class="form-label">Monthly Salary (â‚¹) <span class="text-danger">*</span></label>
                <input type="number" id="employeeSalary" class="form-control rounded" required step="100">
              </div>
              <div class="col-md-3 mb-3">
                <label for="employeeContact" class="form-label">Contact</label>
                <input type="tel" id="employeeContact" class="form-control rounded">
              </div>
            </div>
            <div class="d-flex gap-2">
              <button type="submit" class="btn text-white rounded shadow-md" style="background-color: var(--primary-color);" id="saveEmployeeBtn">
                <i class="fas fa-save me-2"></i>Add Employee
              </button>
              <button type="button" class="btn btn-secondary rounded shadow-md" id="cancelEditBtn" style="display: none;">
                <i class="fas fa-times me-2"></i>Cancel Edit
              </button>
            </div>
          </form>

          <div class="form-section mt-4">
            <h4 class="mb-3">LR Ranking Filter</h4>
            <div class="row align-items-end">
              <div class="col-md-4 mb-3">
                <label for="rankingFromDate" class="form-label">From Date</label>
                <input type="date" id="rankingFromDate" class="form-control rounded">
              </div>
              <div class="col-md-4 mb-3">
                <label for="rankingToDate" class="form-label">To Date</label>
                <input type="date" id="rankingToDate" class="form-control rounded">
              </div>
              <div class="col-md-4 mb-3">
                <button type="button" class="btn text-white rounded shadow-md w-full" style="background-color: var(--primary-color);" onclick="populateEmployeeRankingTable()">
                  <i class="fas fa-chart-bar me-2"></i>Apply Ranking Filter
                </button>
              </div>
            </div>
          </div>


          <h4 class="mb-3 mt-4">Employee Details & Performance Ranking</h4>
          <div class="table-responsive">
            <table id="employeeRankingTable" class="table table-striped table-bordered" style="width:100%">
              <thead>
                <tr>
                  <th>Name</th>
                  <th>Designation</th>
                  <th>Salary (â‚¹)</th>
                  <th class="text-end">Total LRs Generated</th>
                  <th class="text-end">Total Weight (MT)</th>
                  <th class="text-center">Actions</th>
                </tr>
              </thead>
              <tbody id="employeeRankingTableBody"></tbody>
            </table>
          </div>
        </div>
        
        <div class="tab-pane fade" id="attendanceView" role="tabpanel" aria-labelledby="attendance-tab">
            <h4 class="mb-3">Weekly Attendance Calendar</h4>
            <div class="row mb-3 align-items-center">
                <div class="col-auto">
                    <div class="dropdown">
                        <button class="btn btn-outline-secondary dropdown-toggle" type="button" id="dropdownWeekView" data-bs-toggle="dropdown" aria-expanded="false">
                            <i class="fas fa-calendar-alt me-2"></i><span id="currentWeekDisplay">Loading...</span>
                        </button>
                        <ul class="dropdown-menu" aria-labelledby="dropdownWeekView" id="weekSelectorDropdown">
                            </ul>
                    </div>
                </div>
                <div class="col-auto d-flex gap-2">
                    <button class="btn btn-outline-secondary" onclick="changeWeek(-1)"><i class="fas fa-chevron-left"></i> Previous Week</button>
                    <button class="btn btn-outline-secondary" onclick="changeWeek(1)">Next Week <i class="fas fa-chevron-right"></i></button>
                </div>
            </div>

            <div class="attendance-calendar-container overflow-auto">
                <div id="attendanceCalendarGrid" class="attendance-grid">
                    </div>
                <div class="mt-3">
                    <span class="badge status-P">P - Present</span>
                    <span class="badge status-A">A - Absent</span>
                    <span class="badge status-H">H - Half Day</span>
                    <span class="badge status-L">L - Leave</span>
                </div>
            </div>
        </div>

        <div class="tab-pane fade" id="payments" role="tabpanel" aria-labelledby="payments-tab">
            <h4 class="mb-3">Record New Salary Payment Transaction</h4>
            <form id="paymentForm" class="form-section">
                <input type="hidden" id="paymentIdHidden">
                <div class="row">
                    <div class="col-md-4 mb-3">
                        <label for="paymentEmployeeId" class="form-label">Employee <span class="text-danger">*</span></label>
                        <select id="paymentEmployeeId" class="form-select rounded" required>
                            <option value="">Select Employee</option>
                            </select>
                    </div>
                    <div class="col-md-3 mb-3">
                        <label for="paymentDate" class="form-label">Date <span class="text-danger">*</span></label>
                        <input type="date" id="paymentDate" class="form-control rounded" required>
                    </div>
                    <div class="col-md-3 mb-3">
                        <label for="paymentAmount" class="form-label">Amount (â‚¹) <span class="text-danger">*</span></label>
                        <input type="number" id="paymentAmount" class="form-control rounded" required step="100" min="1">
                    </div>
                    <div class="col-md-2 mb-3 d-flex align-items-end">
                        <button type="submit" class="btn text-white rounded shadow-md w-100" style="background-color: var(--primary-color);" id="savePaymentBtn">
                            <i class="fas fa-plus me-2"></i>Record Payment
                        </button>
                    </div>
                </div>
            </form>

            <h5 class="mb-3 mt-4">Detailed Payment Transactions History</h5>
            <div class="table-responsive">
                <table id="paymentDetailTable" class="table table-striped table-bordered" style="width:100%">
                    <thead>
                        <tr>
                            <th>Employee Name</th>
                            <th>Date</th>
                            <th class="text-end">Amount (â‚¹)</th>
                            <th class="text-center">Actions</th>
                        </tr>
                    </thead>
                    <tbody id="paymentDetailTableBody">
                    </tbody>
                </table>
            </div>
        </div>

      </div>
    </div>
  </div>

  <div class="modal fade" id="employeeDetailsModal" tabindex="-1" aria-labelledby="employeeDetailsModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="employeeDetailsModalLabel">Employee Details: <span id="modalEmployeeName"></span></h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
            
            <ul class="nav nav-tabs" id="detailTabs" role="tablist">
                <li class="nav-item" role="presentation">
                    <button class="nav-link active" id="details-tab" data-bs-toggle="tab" data-bs-target="#detailsContent" type="button" role="tab">
                        <i class="fas fa-info-circle me-1"></i> General
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="salary-tab" data-bs-toggle="tab" data-bs-target="#salaryContent" type="button" role="tab">
                        <i class="fas fa-wallet me-1"></i> Salary & Payments
                    </button>
                </li>
            </ul>

            <div class="tab-content pt-3" id="detailTabsContent">
                <div class="tab-pane fade show active" id="detailsContent" role="tabpanel" aria-labelledby="details-tab">
                    <h6>Contact & Role</h6>
                    <p><strong>Designation:</strong> <span id="modalDesignation"></span></p>
                    <p><strong>Contact:</strong> <span id="modalContact"></span></p>
                    <p><strong>Monthly Salary:</strong> <span id="modalSalary"></span></p>
                    <hr>
                    <div class="d-flex gap-2">
                         <button class="btn btn-sm btn-outline-primary" onclick="editEmployeeFromModal()"><i class="fas fa-edit"></i> Edit Details</button>
                         <button class="btn btn-sm btn-outline-danger" onclick="deleteEmployeeFromModal()"><i class="fas fa-trash"></i> Delete Employee</button>
                    </div>
                </div>

                <div class="tab-pane fade" id="salaryContent" role="tabpanel" aria-labelledby="salary-tab">
                    
                    <h5 class="mb-3">Payment Status (Current Month)</h5>
                    <div id="paymentStatusCard" class="alert alert-info" role="alert">
                        </div>

                    <h5 class="mb-3 mt-4">Recent Payment Transactions</h5>
                    <div class="table-responsive">
                        <table id="modalPaymentDetailTable" class="table table-striped table-bordered" style="width:100%">
                            <thead>
                                <tr>
                                    <th>Date</th>
                                    <th class="text-end">Amount (â‚¹)</th>
                                    <th class="text-center">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="modalPaymentDetailTableBody">
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

        </div>
      </div>
    </div>
  </div>

    <!-- Load secure configuration first -->
  
  

  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="navbar-loader.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.datatables.net/1.11.5/js/jquery.dataTables.min.js"></script>
  <script src="https://cdn.datatables.net/1.11.5/js/dataTables.bootstrap5.min.js"></script>

  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-database-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-auth-compat.js"></script>

  
</body>
</html>
