<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ”§ Configuration Test</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-5">
        <div class="row justify-content-center">
            <div class="col-md-8">
                <div class="card">
                    <div class="card-header bg-success text-white">
                        <h3 class="mb-0">ğŸ”§ EVM Configuration Test</h3>
                    </div>
                    <div class="card-body">
                        <div id="testResults"></div>
                        <button onclick="testConfiguration()" class="btn btn-primary mt-3">
                            ğŸ§ª Test Configuration
                        </button>
                        <button onclick="testFirebaseAuth()" class="btn btn-success mt-3 ms-2">
                            ğŸ”¥ Test Firebase Auth
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Load secure configuration first -->
    <script src="evm.js"></script>
    <script src="config-loader.js"></script>
    
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-auth-compat.js"></script>
    
    <script>
        function testConfiguration() {
            const results = document.getElementById('testResults');
            
            try {
                // Test EVM loading
                const envInfo = ConfigManager.getEnvironmentInfo();
                const firebaseConfig = ConfigManager.getFirebaseConfig();
                const cloudinaryConfig = ConfigManager.getCloudinaryConfig();
                
                let html = '<div class="alert alert-info">';
                html += '<h5>ğŸ” Configuration Test Results:</h5>';
                html += '<strong>EVM Status:</strong> ' + (envInfo.hasEVM ? 'âœ… Loaded' : 'âŒ Not Found') + '<br>';
                html += '<strong>Using Fallback:</strong> ' + (envInfo.usingFallback ? 'âš ï¸ Yes' : 'âœ… No') + '<br>';
                html += '<strong>Firebase Project:</strong> ' + firebaseConfig.projectId + '<br>';
                html += '<strong>Firebase API Key:</strong> ' + (firebaseConfig.apiKey.includes('AIza') ? 'âœ… Valid Format' : 'âŒ Invalid') + '<br>';
                html += '<strong>Cloudinary Name:</strong> ' + cloudinaryConfig.cloudName + '<br>';
                html += '<strong>Cloudinary Preset:</strong> ' + cloudinaryConfig.uploadPreset + '<br>';
                html += '</div>';
                
                results.innerHTML = html;
                
                console.log('âœ… Configuration test completed');
                console.log('ğŸ”¥ Firebase:', firebaseConfig);
                console.log('â˜ï¸ Cloudinary:', cloudinaryConfig);
                
            } catch (error) {
                results.innerHTML = '<div class="alert alert-danger"><strong>âŒ Error:</strong> ' + error.message + '</div>';
                console.error('âŒ Configuration test failed:', error);
            }
        }
        
        function testFirebaseAuth() {
            const results = document.getElementById('testResults');
            
            try {
                // Initialize Firebase
                const firebaseConfig = ConfigManager.getFirebaseConfig();
                firebase.initializeApp(firebaseConfig);
                
                results.innerHTML = '<div class="alert alert-warning"><strong>ğŸ”„ Testing Firebase...</strong> Please wait...</div>';
                
                // Test a simple auth operation (this will fail but shows the API key works)
                firebase.auth().signInAnonymously()
                    .then(() => {
                        results.innerHTML = '<div class="alert alert-success"><strong>âœ… Firebase Auth Working!</strong> API key is valid.</div>';
                    })
                    .catch((error) => {
                        if (error.code === 'auth/api-key-not-valid') {
                            results.innerHTML = '<div class="alert alert-danger"><strong>âŒ Firebase API Key Invalid!</strong> Please check evm.js configuration.</div>';
                        } else {
                            results.innerHTML = '<div class="alert alert-success"><strong>âœ… Firebase API Key Valid!</strong> (Expected error: ' + error.message + ')</div>';
                        }
                    });
                    
            } catch (error) {
                results.innerHTML = '<div class="alert alert-danger"><strong>âŒ Firebase Test Failed:</strong> ' + error.message + '</div>';
                console.error('âŒ Firebase test failed:', error);
            }
        }
        
        // Auto-test on page load
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸ”§ Configuration test page loaded');
            setTimeout(testConfiguration, 1000);
        });
    </script>
</body>
</html>
