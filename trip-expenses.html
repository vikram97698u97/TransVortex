<!DOCTYPE html>
<html lang="en">
<head>
    
<!-- üîê Secure .env Configuration Loader -->
    <!-- üîê Secure Configuration - Loaded from .env -->
    <script>
        // Configuration loaded from .env file (server-side)
        (function() {
            'use strict';
            
            // Firebase configuration from .env
            if (!window.FIREBASE_CONFIG) {
                apiKey: window.SECURE_FIREBASE_CONFIG?.apiKey || "";
            }
            
            // Cloudinary configuration from .env
            if (!window.CLOUDINARY_CONFIG) {
                window.CLOUDINARY_CONFIG = {
                    cloudName: "doqapn15f",
                    uploadPreset: "vehicle-driver",
                    presets: {
                        vehicleDriver: "vehicle-driver",
                        paymentBilling: "payment-billing",
                        profilePic: "profile-pic",
                        documents: "documents",
                        receipts: "receipts",
                        expenses: "expenses",
                        tyres: "tyres",
                        vehicles: "vehicles",
                        drivers: "drivers",
                        invoices: "invoices",
                        lrReports: "lr-reports",
                        tripExpenses: "trip-expenses"
                    },
                    folders: {
                        vehicles: "transport/vehicles",
                        drivers: "transport/drivers", 
                        documents: "transport/documents",
                        profiles: "transport/profiles",
                        receipts: "transport/receipts",
                        expenses: "transport/expenses",
                        tyres: "transport/tyres",
                        invoices: "transport/invoices",
                        lrReports: "transport/lr-reports",
                        tripExpenses: "transport/trip-expenses"
                    },
                    apiUrl: "https://api.cloudinary.com/v1_1/doqapn15f/image/upload",
                    baseUrl: "https://res.cloudinary.com/doqapn15f/image/upload"
                };
            }
            
            // Environment configuration from .env
            if (!window.ENVIRONMENT) {
                window.ENVIRONMENT = {
                    name: "production",
                    debug: false,
                    apiBaseUrl: "https://transvortex.online",
                    version: "1.0.0",
                    corsOrigin: "https://transvortex.online",
                    allowedOrigins: "https://transvortex.online,http://localhost:3000",
                    apiRateLimit: 100
                };
            }
            
            // Security configuration from .env
            if (!window.SECURITY_CONFIG) {
                window.SECURITY_CONFIG = {
                    sessionSecret: "transvortex-session-secret-2024",
                    jwtSecret: "transvortex-jwt-secret-2024",
                    encryptionKey: "transvortex-encryption-key-2024"
                };
            }
            
            // Optional API configurations from .env
            if (!window.API_CONFIG) {
                window.API_CONFIG = {
                    email: {
                        provider: "sendgrid",
                        window.SECURE_FIREBASE_CONFIG || await window.SECURE_CONFIG_LOADER.loadConfig(),
                        from: "noreply@transvortex.online",
                        fromName: "TransVortex Transport"
                    },
                    payment: {
                        provider: "stripe",
                        publicKey: "your-stripe-public-key-here"
                    },
                    sms: {
                        provider: "twilio",
                        accountSid: "your-twilio-account-sid-here",
                        phoneNumber: "your-twilio-phone-number-here"
                    },
                    maps: {
                        googleMapsApiKey: "your-google-maps-api-key-here",
                        googlePlacesApiKey: "your-google-places-api-key-here"
                    },
                    analytics: {
                        googleAnalyticsId: "GA-XXXXXXXXX",
                        facebookPixelId: "your-facebook-pixel-id-here",
                        hotjarId: "your-hotjar-id-here"
                    }
                };
            }
            
            // Log successful loading (only in debug mode)
            if (window.ENVIRONMENT.debug) {
                console.log('‚úÖ Secure configuration loaded from .env');
                console.log('üî• Firebase:', window.FIREBASE_CONFIG.projectId);
                console.log('‚òÅÔ∏è Cloudinary:', window.CLOUDINARY_CONFIG.cloudName);
                console.log('üåç Environment:', window.ENVIRONMENT.name);
                console.log('üîê Security: Loaded');
            }
            
            // Dispatch event when configuration is ready
            window.dispatchEvent(new CustomEvent('envConfigLoaded', {
                detail: {
                    firebase: window.FIREBASE_CONFIG,
                    cloudinary: window.CLOUDINARY_CONFIG,
                    environment: window.ENVIRONMENT,
                    security: window.SECURITY_CONFIG,
                    apis: window.API_CONFIG
                }
            }));
        })();
    </script>



  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Trip Expenses - Transport System</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"/>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.datatables.net/1.11.5/css/dataTables.bootstrap5.min.css" rel="stylesheet">
  <style>
    body { padding: 0; margin: 0; background-color: #f8f9fa; }
    .tab-content { background: white; padding: 20px; border-radius: 0 0 8px 8px; }
    .profit-positive { color: green; font-weight: bold; }
    .profit-negative { color: red; font-weight: bold; }
    .summary-card { border-radius: 8px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
    .empty-trip-row { background-color: #ffebee !important; }
    .empty-btn { background: none; border: none; color: #dc3545; cursor: pointer; }
    .empty-btn:hover { color: #c82333; }
    .modal-backdrop { z-index: 1040; }
    .modal { z-index: 1050; }
    /* Styles for child row */
    td.details-control {
        background: url('https://datatables.net/examples/resources/details_open.png') no-repeat center center;
        cursor: pointer;
    }
    tr.details td.details-control {
        background: url('https://datatables.net/examples/resources/details_close.png') no-repeat center center;
    }
    .child-row-table {
      width: 100%;
      margin: 10px 0;
    }
    .child-row-table th, .child-row-table td {
      padding: 8px;
      border: 1px solid #e0e0e0;
    }
    .child-row-table th {
      background-color: #f2f2f2;
      font-weight: 600;
    }
    .child-row-container {
      padding: 10px 20px;
    }
    .card-value {
      font-size: 1.5rem;
      font-weight: bold;
      margin-bottom: 0.25rem;
    }
    .card-label {
      font-size: 0.875rem;
      color: #6c757d;
    }
    .card-icon {
      font-size: 2rem;
      opacity: 0.7;
    }
  </style>
    <!-- Load secure configuration first -->
  
  

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <!-- üî• Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-storage-compat.js"></script>
    
    <!-- üîê Configuration Loading -->
    <script src="evm.js"></script>
    <script src="secure-api-loader.js"></script>
</head>
<body>

  <div id="navbar-placeholder"></div>

  <div class="container">
    <h2 class="mb-4"><i class="fas fa-money-bill-wave me-2"></i>Trip Expenses</h2>
    
    <div class="row mb-4">
      <div class="col-md-2 mb-3">
        <div class="card summary-card border-primary">
          <div class="card-body text-center">
            <div class="card-icon text-primary mb-2">
              <i class="fas fa-file-invoice-dollar"></i>
            </div>
            <div class="card-value text-primary" id="totalBilling">‚Çπ0.00</div>
            <div class="card-label">Total Billing</div>
          </div>
        </div>
      </div>
      <div class="col-md-2 mb-3">
        <div class="card summary-card border-info">
          <div class="card-body text-center">
            <div class="card-icon text-info mb-2">
              <i class="fas fa-money-bill-wave"></i>
            </div>
            <div class="card-value text-info" id="totalExpenses">‚Çπ0.00</div>
            <div class="card-label">Total Expenses</div>
          </div>
        </div>
      </div>
      <div class="col-md-2 mb-3">
        <div class="card summary-card border-success">
          <div class="card-body text-center">
            <div class="card-icon text-success mb-2">
              <i class="fas fa-chart-line"></i>
            </div>
            <div class="card-value text-success" id="totalProfit">‚Çπ0.00</div>
            <div class="card-label">Total Profit</div>
          </div>
        </div>
      </div>
      <div class="col-md-2 mb-3">
        <div class="card summary-card border-warning">
          <div class="card-body text-center">
            <div class="card-icon text-warning mb-2">
              <i class="fas fa-truck"></i>
            </div>
            <div class="card-value text-warning" id="tripsCount">0</div>
            <div class="card-label">Trips Count</div>
          </div>
        </div>
      </div>
      <div class="col-md-2 mb-3">
        <div class="card summary-card border-secondary">
          <div class="card-body text-center">
            <div class="card-icon text-secondary mb-2">
              <i class="fas fa-gas-pump"></i>
            </div>
            <div class="card-value text-secondary" id="totalDiesel">‚Çπ0.00</div>
            <div class="card-label">Diesel Expenses</div>
          </div>
        </div>
      </div>
      <div class="col-md-2 mb-3">
        <div class="card summary-card border-danger">
          <div class="card-body text-center">
            <div class="card-icon text-danger mb-2">
              <i class="fas fa-tools"></i>
            </div>
            <div class="card-value text-danger" id="totalOtherExp">‚Çπ0.00</div>
            <div class="card-label">Other Expenses</div>
          </div>
        </div>
      </div>
    </div>

    <div class="row mb-3">
      <div class="col-md-3">
        <label class="form-label">From Date</label>
        <input type="date" class="form-control" id="fromDate">
      </div>
      <div class="col-md-3">
        <label class="form-label">To Date</label>
        <input type="date" class="form-control" id="toDate">
      </div>
      <div class="col-md-3">
        <label class="form-label">Vehicle Number</label>
        <select class="form-select" id="vehicleFilter">
          <option value="">All Vehicles</option>
        </select>
      </div>
      <div class="col-md-2">
        <label class="form-label">Trip Type</label>
        <select class="form-select" id="tripTypeFilter">
          <option value="">All Trips</option>
          <option value="with_empty">With Empty Return</option>
          <option value="without_empty">Standard Trips</option>
        </select>
      </div>
      <div class="col-md-1 d-flex align-items-end">
        <button class="btn btn-primary me-2" id="applyFiltersBtn">Filter</button>
      </div>
      <div class="col-md-1 d-flex align-items-end">
        <button class="btn btn-success" id="exportPdfBtn">PDF</button>
      </div>
    </div>

    <div class="table-responsive">
      <table id="expensesTable" class="table table-striped">
        <thead>
          <tr>
            <th>Empty</th>
            <th>Date</th>
            <th>Vehicle No</th>
            <th>LR No</th>
            <th>From</th>
            <th>To</th>
            <th class="text-end">Tyre Exp</th>
            <th class="text-end">Diesel Exp</th>
            <th class="text-end">Advance</th>
            <th class="text-end">Toll</th>
            <th class="text-end">Commission</th>
            <th class="text-end">Vehicle Work</th>
            <th class="text-end">Tirpal/Rope</th>
            <th class="text-end">Other Exp</th>
            <th class="text-end">Food Exp</th>
            <th class="text-end">Shortage Amt</th>
            <th class="text-end">Billing Amt</th>
            <th class="text-end">Total Exp</th>
            <th class="text-end">Profit</th>
          </tr>
        </thead>
        <tbody>
          </tbody>
        <tfoot>
          <tr>
            <th colspan="6" style="text-align:right;">Page Total:</th>
            <th class="text-end"></th>
            <th class="text-end"></th>
            <th class="text-end"></th>
            <th class="text-end"></th>
            <th class="text-end"></th>
            <th class="text-end"></th>
            <th class="text-end"></th>
            <th class="text-end"></th>
            <th class="text-end"></th>
            <th class="text-end"></th>
            <th class="text-end"></th>
            <th class="text-end"></th>
            <th class="text-end"></th>
          </tr>
        </tfoot>
      </table>
    </div>
  </div>

  <!-- The modal for adding/editing empty trip expenses has been removed to make this page view-only for that data. -->

  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="navbar-loader.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.datatables.net/1.11.5/js/jquery.dataTables.min.js"></script>
  <script src="https://cdn.datatables.net/1.11.5/js/dataTables.bootstrap5.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>
  
  <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-database-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-auth-compat.js"></script>
  
  
</body>
</html>
