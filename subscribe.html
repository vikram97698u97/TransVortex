<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Activate Your Subscription - Transport Dashboard</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  <!-- Using a different QR code library -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
  <style>
    :root {
      --primary: #2E8B57;
      --primary-dark: #1e6b41;
      --secondary: #3CB371;
      --text: #333;
      --light-bg: #f5f7fa;
      --white: #fff;
      --border: #e1e4e8;
      --danger: #ff6b6b;
      --accent: #ffc107;
    }
    
    * { box-sizing: border-box; margin: 0; padding: 0; }
    
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      line-height: 1.6;
      background: var(--light-bg);
      color: var(--text);
      padding: 20px;
    }
    
    .container {
      max-width: 800px;
      margin: 40px auto;
      background: var(--white);
      border-radius: 12px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.08);
      overflow: hidden;
    }
    
    .header {
      background: var(--primary);
      color: white;
      padding: 30px 40px;
      text-align: center;
    }
    
    .header h1 {
      margin-bottom: 10px;
      font-size: 2rem;
    }
    
    .header p {
      opacity: 0.9;
      max-width: 600px;
      margin: 0 auto;
    }
    
    .content {
      padding: 30px 40px;
    }
    
    .plan-card {
      border: 1px solid var(--border);
      border-radius: 10px;
      padding: 30px;
      margin-bottom: 30px;
      text-align: center;
      transition: transform 0.3s, box-shadow 0.3s;
    }
    
    .plan-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 30px rgba(0,0,0,0.1);
    }
    
    .plan-name {
      font-size: 1.8rem;
      color: var(--primary);
      margin-bottom: 10px;
      text-transform: capitalize;
    }
    
    .price {
      font-size: 3rem;
      font-weight: 700;
      color: var(--primary);
      margin: 20px 0;
    }
    
    .price span {
      font-size: 1rem;
      color: #666;
      font-weight: normal;
    }
    
    .btn {
      display: inline-block;
      background: var(--primary);
      color: white;
      border: none;
      padding: 12px 30px;
      border-radius: 8px;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      text-decoration: none;
      transition: background 0.3s;
      width: 100%;
      text-align: center;
    }
    
    .btn:hover {
      background: var(--primary-dark);
    }
    
    .btn:disabled {
      background: #cccccc;
      cursor: not-allowed;
    }
    
    .qr-container {
      text-align: center;
      margin: 20px 0;
      padding: 20px;
      border: 1px solid var(--border);
      border-radius: 8px;
      display: none;
    }
    
    #qrcode {
      margin: 0 auto;
      padding: 10px;
      background: white;
      display: inline-block;
    }
    
    .payment-status {
      margin-top: 20px;
      padding: 15px;
      border-radius: 8px;
      text-align: center;
      display: none;
    }
    
    .payment-success {
      background-color: #e8f5e9;
      color: #2e7d32;
      border: 1px solid #a5d6a7;
    }
    
    .payment-error {
      background-color: #ffebee;
      color: #c62828;
      border: 1px solid #ef9a9a;
    }
    
    .trial-info {
      background: #f8f9fa;
      padding: 15px;
      border-radius: 8px;
      margin-top: 20px;
      text-align: center;
      border: 1px dashed var(--border);
    }

    /* Billing Cycle Selector */
    .billing-cycle-selector {
      margin: 30px 0;
    }
    .billing-cycle-selector h4 {
      text-align: center;
      margin-bottom: 20px;
      font-weight: 600;
      color: var(--text);
    }
    .cycle-options {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
    }
    .cycle-option {
      position: relative;
    }
    .cycle-option input[type="radio"] {
      position: absolute;
      opacity: 0;
      width: 100%;
      height: 100%;
      cursor: pointer;
    }
    .cycle-option label {
      display: block;
      padding: 20px;
      border: 2px solid var(--border);
      border-radius: 10px;
      text-align: center;
      transition: all 0.3s ease;
    }
    .cycle-option input[type="radio"]:checked + label {
      border-color: var(--primary);
      background-color: #e8f5e9;
      box-shadow: 0 0 0 3px var(--primary);
    }
    .cycle-option label strong {
      display: block;
      font-size: 1.1rem;
      margin-bottom: 5px;
    }
    .discount-badge {
      background-color: var(--accent);
      color: var(--text);
      font-size: 0.75rem;
      padding: 3px 8px;
      border-radius: 12px;
      font-weight: 700;
      margin-top: 5px;
      display: inline-block;
    }
    
    .trial-info i {
      color: var(--primary);
      margin-right: 5px;
    }
    
    @media (max-width: 768px) {
      .container {
        margin: 20px 10px;
      }
      
      .header, .content {
        padding: 20px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>Subscription Status</h1>
      <p id="statusMessage">Your subscription details are being loaded...</p>
    </div>
    
    <div class="content">
      <!-- Payment Form -->
      <div id="paymentForm">
        <div class="plan-card">
          <h2 id="planName" class="plan-name">Loading Plan...</h2>
          <div id="planPrice" class="price">₹0<span>/month</span></div>
          <p>Your plan includes <strong id="vehicleLimit">0</strong> vehicles.</p>
          
          <!-- Billing Cycle Selector -->
          <div class="billing-cycle-selector">
            <h4>Select Billing Cycle</h4>
            <div id="billingCycleOptions" class="cycle-options">
              <!-- Options will be dynamically inserted here -->
            </div>
          </div>
          
          <button id="subscribeBtn" class="btn" disabled>Loading Plan...</button>
          
          <!-- QR Code Container -->
          <div id="qrContainer" class="qr-container">
            <h3>Scan to Pay with UPI</h3>
            <div id="qrcode"></div>
            <p>Amount: <strong id="paymentAmount">₹0</strong></p>
            <p>UPI ID: <strong>singhvikram43210s@okhdfcbank</strong></p>
            <p>Reference: <strong id="paymentRef"></strong></p>
            <p>After successful payment, click below to verify</p>
            <button id="verifyPaymentBtn" class="btn" style="margin-top: 15px; background: #4CAF50;">I've Made the Payment</button>
            <button id="cancelPaymentBtn" class="btn" style="margin-top: 10px; background: #f44336;">Cancel</button>
          </div>
          
          <!-- Payment Status -->
          <div id="paymentStatus" class="payment-status">
            <i class="fas fa-spinner fa-spin"></i>
            <p>Verifying your payment...</p>
          </div>
        </div>
      </div>
      
      <!-- Pending Approval -->
      <div id="pendingApproval" class="status-card" style="display: none;">
        <div class="status-icon">
          <i class="fas fa-clock" style="color: #ff9800; font-size: 48px;"></i>
        </div>
        <h2>Subscription Pending Approval</h2>
        <p id="pendingMessage">Your subscription request is being reviewed by our team.</p>
        <p>You will receive an email once your subscription is approved.</p>
        <div class="action-buttons">
          <button id="checkStatusBtn" class="btn">Check Status</button>
          <button id="contactSupportBtn" class="btn btn-outline">Contact Support</button>
        </div>
      </div>
      
      <!-- Rejected -->
      <div id="rejectedStatus" class="status-card" style="display: none;">
        <div class="status-icon">
          <i class="fas fa-times-circle" style="color: #f44336; font-size: 48px;"></i>
        </div>
        <h2>Subscription Declined</h2>
        <p id="rejectionReason">Your payment was not approved.</p>
        <div class="action-buttons">
          <button id="tryAgainBtn" class="btn">Try Again</button>
          <button id="contactSupportBtn2" class="btn btn-outline">Contact Support</button>
        </div>
      </div>

      <div class="trial-info">
        <i class="fas fa-info-circle"></i>
        <span id="trialMessage">Your subscription has ended. Subscribe to continue using all features again.</span>
      </div>
    </div>
  </div>

  <script type="module">
    // Import Firebase modules
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
    import { 
      getDatabase, 
      ref, 
      set, 
      update, 
      get, 
      query, 
      orderByChild, 
      equalTo 
    } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-database.js";
    import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";
    
    // Firebase configuration
    const firebaseConfig = {
      apiKey: "AIzaSyDAlk_K8p8Of8Ne6Jpcl2QqXTtm95NgG7o",
      authDomain: "transport-dashboard-ad69a.firebaseapp.com",
      databaseURL: "https://transport-dashboard-ad69a-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "transport-dashboard-ad69a",
      storageBucket: "transport-dashboard-ad69a.appspot.com",
      messagingSenderId: "526889676196",
      appId: "1:526889676196:web:66032c80a4aede690ae531",
      measurementId: "G-7F9R7HJYDH"
    };
    
    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    const auth = getAuth(app);
    
    // Generate a unique payment reference
    function generatePaymentRef() {
      return 'PAY-' + Date.now() + '-' + Math.random().toString(36).substr(2, 5).toUpperCase();
    }
    
    // Show payment status
    function showStatus(message, isError = false) {
      const statusDiv = document.getElementById('paymentStatus');
      statusDiv.innerHTML = `<p style="color: ${isError ? 'red' : 'green'}">${message}</p>`;
      statusDiv.style.display = 'block';
    }
    
    // Add styles for status cards
    const style = document.createElement('style');
    style.textContent = `
      .status-card {
        text-align: center;
        padding: 40px 20px;
        background: white;
        border-radius: 10px;
        box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        margin-bottom: 30px;
      }
      .status-icon {
        margin-bottom: 20px;
      }
      .status-card h2 {
        color: #333;
        margin-bottom: 15px;
      }
      .status-card p {
        color: #666;
        margin-bottom: 20px;
        max-width: 500px;
        margin-left: auto;
        margin-right: auto;
      }
      .action-buttons {
        display: flex;
        gap: 15px;
        justify-content: center;
        margin-top: 25px;
      }
      .btn-outline {
        background: white;
        border: 1px solid var(--primary);
        color: var(--primary);
      }
      .btn-outline:hover {
        background: #f5f5f5;
      }
    `;
    document.head.appendChild(style);
    
    onAuthStateChanged(auth, (user) => {
      if (!user) {
        window.location.href = `login.html?redirect=subscribe.html`;
        return;
      }
      initializePage(user);
    });
    
    async function initializePage(user) {
      // Get all elements
      const paymentForm = document.getElementById('paymentForm');
      const pendingApproval = document.getElementById('pendingApproval');
      const rejectedStatus = document.getElementById('rejectedStatus');
      const statusMessage = document.getElementById('statusMessage');
      const pendingMessage = document.getElementById('pendingMessage');
      const rejectionReason = document.getElementById('rejectionReason');
      
      const subscribeBtn = document.getElementById('subscribeBtn');
      const qrContainer = document.getElementById('qrContainer');
      const verifyPaymentBtn = document.getElementById('verifyPaymentBtn');
      const cancelPaymentBtn = document.getElementById('cancelPaymentBtn');
      const checkStatusBtn = document.getElementById('checkStatusBtn');
      const tryAgainBtn = document.getElementById('tryAgainBtn');
      const contactSupportBtn = document.getElementById('contactSupportBtn');
      const contactSupportBtn2 = document.getElementById('contactSupportBtn2');
      
      // Dynamic UI elements
      const planNameEl = document.getElementById('planName');
      const planPriceEl = document.getElementById('planPrice');
      const vehicleLimitEl = document.getElementById('vehicleLimit');
      const paymentRefElement = document.getElementById('paymentRef');
      const paymentAmountEl = document.getElementById('paymentAmount');
      const paymentStatus = document.getElementById('paymentStatus');
      const qrCodeElement = document.getElementById('qrcode');

      // Check URL for status parameters
      const urlParams = new URLSearchParams(window.location.search);
      const status = urlParams.get('status') || sessionStorage.getItem('subscriptionStatus');
      const message = sessionStorage.getItem('pendingMessage');
      const reason = sessionStorage.getItem('rejectionReason');
      
      // Clear session storage after reading
      sessionStorage.removeItem('subscriptionStatus');
      sessionStorage.removeItem('pendingMessage');
      sessionStorage.removeItem('rejectionReason');
      
      // Show appropriate view based on status
      function showView(view) {
        paymentForm.style.display = 'none';
        pendingApproval.style.display = 'none';
        rejectedStatus.style.display = 'none';
        
        switch(view) {
          case 'payment':
            paymentForm.style.display = 'block';
            statusMessage.textContent = 'Activate Your Subscription';
            break;
          case 'pending':
            pendingApproval.style.display = 'block';
            statusMessage.textContent = 'Subscription Status';
            if (message) pendingMessage.textContent = message;
            break;
          case 'rejected':
            rejectedStatus.style.display = 'block';
            statusMessage.textContent = 'Subscription Update';
            if (reason) rejectionReason.textContent = reason;
            break;
        }
      }
      
      // **FIXED**: Fetch and display plan details
      async function loadPlanDetails() {
        // **FIX**: Use the correct path to the subscription data.
        const subRef = ref(db, `users/${user.uid}/subscription`);
        const snapshot = await get(subRef);

        if (!snapshot.exists()) {
          statusMessage.textContent = "Error: Could not find your plan details.";
          paymentForm.style.display = 'none';
          return;
        }
        const sub = snapshot.val();
        const baseRate = sub.monthlyRate || 0;

        // Update UI with plan details
        planNameEl.textContent = `${sub.planId || 'Basic'} Plan`;
        vehicleLimitEl.textContent = sub.vehicleLimit === -1 ? 'Unlimited' : `up to ${sub.vehicleLimit}`;

        // Create billing cycle options
        const billingOptionsContainer = document.getElementById('billingCycleOptions');
        billingOptionsContainer.innerHTML = `
          <div class="cycle-option">
            <input type="radio" id="cycle-1" name="billingCycle" value="1" data-amount="${baseRate}" checked>
            <label for="cycle-1">
              <strong>1 Month</strong>
              <span>₹${baseRate.toLocaleString('en-IN')}</span>
            </label>
          </div>
          <div class="cycle-option">
            <input type="radio" id="cycle-5" name="billingCycle" value="5" data-amount="${Math.round(baseRate * 5 * 0.95)}">
            <label for="cycle-5">
              <strong>5 Months</strong>
              <span>₹${Math.round(baseRate * 5 * 0.95).toLocaleString('en-IN')}</span>
              <span class="discount-badge">5% OFF</span>
            </label>
          </div>
          <div class="cycle-option">
            <input type="radio" id="cycle-12" name="billingCycle" value="12" data-amount="${Math.round(baseRate * 12 * 0.90)}">
            <label for="cycle-12">
              <strong>1 Year</strong>
              <span>₹${Math.round(baseRate * 12 * 0.90).toLocaleString('en-IN')}</span>
              <span class="discount-badge">10% OFF</span>
            </label>
          </div>
        `;

        // **FIX**: Force the first radio button to be selected
        setTimeout(() => {
          const firstRadio = document.getElementById('cycle-1');
          if (firstRadio) {
            // **FIX**: Enable the button only after the default option is checked.
            const subscribeBtn = document.getElementById('subscribeBtn');
            subscribeBtn.disabled = false;
            subscribeBtn.textContent = 'Pay Now';
            firstRadio.checked = true;
          }
          updateDisplayPrice();
        }, 100);

        // Function to update the main price display
        const updateDisplayPrice = () => {
          const selectedOption = document.querySelector('input[name="billingCycle"]:checked');
          if (selectedOption) {
            const amount = selectedOption.dataset.amount;
            const months = selectedOption.value;
            planPriceEl.innerHTML = `₹${parseInt(amount).toLocaleString('en-IN')}<span>/ ${months} month${months > 1 ? 's' : ''}</span>`;
          }
        };

        // Add event listeners to radio buttons
        document.querySelectorAll('input[name="billingCycle"]').forEach(radio => {
          radio.addEventListener('change', updateDisplayPrice);
        });
      }

      // **FIXED**: When user clicks subscribe button
      subscribeBtn.addEventListener('click', async () => {
        try {
          if (!user) {
            throw new Error('Please log in to subscribe');
          }
          
          const selectedCycle = document.querySelector('input[name="billingCycle"]:checked');
          if (!selectedCycle) {
            throw new Error("Please select a billing cycle.");
          }
          const amountToPay = parseInt(selectedCycle.dataset.amount, 10);
          const months = parseInt(selectedCycle.value, 10);

          // **FIX**: Validate the amount
          if (isNaN(amountToPay) || amountToPay <= 0) {
            throw new Error("Invalid payment amount. Please try again.");
          }

          const paymentRef = generatePaymentRef();
          
          // **FIXED**: Use set instead of update for new payment
          await set(ref(db, `subscriptionPayments/${paymentRef}`), {
            userId: user.uid,
            amount: amountToPay,
            status: 'pending',
            createdAt: new Date().toISOString(),
            clientId: user.uid,
            timestamp: new Date().toISOString(),
            plan: 'monthly'
          });
          
          sessionStorage.setItem('currentPaymentRef', paymentRef);
          
          paymentRefElement.textContent = paymentRef;
          paymentAmountEl.textContent = `₹${amountToPay.toLocaleString('en-IN')}`;
          qrContainer.style.display = 'block';
          subscribeBtn.style.display = 'none';
          
          const upiId = 'singhvikram43210s@okhdfcbank';
          const amount = `${amountToPay}.00`; 
          const note = `Payment Ref: ${paymentRef}`;
          const upiLink = `upi://pay?pa=${encodeURIComponent(upiId)}&pn=Your%20Business&am=${amount}&tn=${encodeURIComponent(note)}`;
          
          qrCodeElement.innerHTML = '';
          
          new QRCode(qrCodeElement, {
            text: upiLink,
            width: 200,
            height: 200,
            colorDark: '#000000',
            colorLight: '#ffffff',
            correctLevel: QRCode.CorrectLevel.H
          });
          
          qrContainer.style.display = 'block';
          
        } catch (error) {
          console.error('Error creating payment:', error);
          showStatus(error.message || 'Error creating payment. Please try again.', true);
        }
      });

      // **FIXED**: When user clicks verify payment button
      verifyPaymentBtn.addEventListener('click', async () => {
        try {
          if (!user) {
            throw new Error('User not authenticated. Please log in again.');
          }

          // Get the payment reference from session
          const paymentReference = sessionStorage.getItem('currentPaymentRef');
          if (!paymentReference) {
            throw new Error('No payment reference found. Please try subscribing again.');
          }

          // Show verifying message
          qrContainer.style.display = 'none';
          paymentStatus.style.display = 'block';
          paymentStatus.innerHTML = `
            <div class="status-message">
              <i class="fas fa-spinner fa-spin" style="font-size: 48px; margin-bottom: 20px;"></i>
              <h3>Verifying Payment...</h3>
              <p>Please wait while we verify your payment.</p>
            </div>
          `;

          // Check payment status with polling
          let paymentVerified = false;
          let attempts = 0;
          const maxAttempts = 30;
          
          while (attempts < maxAttempts && !paymentVerified) {
            attempts++;
            await new Promise(resolve => setTimeout(resolve, 2000));
            
            // Check payment status
            const paymentSnap = await get(ref(db, `subscriptionPayments/${paymentReference}`));
            if (!paymentSnap.exists()) continue;
            
            const paymentData = paymentSnap.val();
            if (paymentData.status === 'verified') {
              paymentVerified = true;
              break;
            } else if (paymentData.status === 'failed') {
              throw new Error('Payment was rejected. Please contact support.');
            }
          }
          
          if (!paymentVerified) {
            throw new Error('Payment verification timed out. Please contact support if your payment was successful.');
          }

          // ✅ Payment verified → update subscription
          const selectedCycle = document.querySelector('input[name="billingCycle"]:checked');
          const months = parseInt(selectedCycle.value, 10);
          const amountPaid = parseInt(selectedCycle.dataset.amount, 10);

          const now = new Date();
          const subscriptionEnd = new Date();
          subscriptionEnd.setMonth(subscriptionEnd.getMonth() + months);

          // Get existing subscription data
          const userRef = ref(db, `users/${user.uid}`);
          const userSnap = await get(userRef);
          const existingData = userSnap.val() || {};
          const existingSubscription = existingData.subscription || {};

          // **FIX**: Create subscription data, preserving the original plan details.
          const subscriptionData = {
            status: 'active',
            // Carry over the plan details from the trial/previous subscription
            planId: existingSubscription.planId || 'starter',
            vehicleLimit: existingSubscription.vehicleLimit || 50, // Default to 50 if not found
            monthlyRate: existingSubscription.monthlyRate || 699, // Default rate
            // Update dates and status
            startDate: now.toISOString(),
            endDate: subscriptionEnd.toISOString(),
            nextPayment: subscriptionEnd.toISOString(),
            lastPayment: now.toISOString(),
            paymentRef: paymentReference,
            updatedAt: now.toISOString(), // Keep trial start/end for historical reference
            trialStart: existingSubscription.trialStart || now.toISOString(),
            trialEnd: existingSubscription.trialEnd || now.toISOString()
          };

          // **FIX**: Perform updates on specific paths instead of a single root update
          // to comply with security rules.
          await update(ref(db, `users/${user.uid}`), {
            subscription: subscriptionData,
            'profile/subscription': subscriptionData, // Also update profile for consistency
            lastPayment: now.toISOString()
          });

          // For core accounts, update core subscription
          if (existingData.accountType === 'core') {
            await set(ref(db, `coreSubscriptions/${user.uid}`), {
              status: 'active',
              endDate: subscriptionEnd.toISOString(),
              lastUpdated: now.toISOString()
            });
          }
          
          // Clear payment ref
          sessionStorage.removeItem('currentPaymentRef');

          // Show success message + redirect
          paymentStatus.innerHTML = `
            <div class="status-message">
              <i class="fas fa-check-circle" style="color: #4CAF50; font-size: 48px;"></i>
              <h3>Payment Verified Successfully!</h3>
              <p>Your subscription has been activated.</p>
              <p>Redirecting to dashboard...</p>
            </div>
          `;

          // Redirect based on account type
          const userProfileRef = ref(db, `users/${user.uid}`);
          const userProfileSnap = await get(userProfileRef);
          let destination = 'home.html';
          if (userProfileSnap.exists()) {
            const userData = userProfileSnap.val();
            if (userData.accountType === 'core') {
              destination = 'branch-selection.html';
            }
          }
          setTimeout(() => {
            window.location.href = destination;
          }, 2000);
          
        } catch (error) {
          console.error('Payment verification error:', error);
          paymentStatus.innerHTML = `
            <div class="status-message">
              <i class="fas fa-exclamation-triangle" style="color: #f44336; font-size: 48px;"></i>
              <h3>Verification Failed</h3>
              <p>${error.message}</p>
              <button onclick="window.location.reload()" class="btn" style="margin-top: 15px;">Try Again</button>
            </div>
          `;
        }
      });
      
      async function setupPage() {
        await loadPlanDetails();

        // Initial view setup
        if (status === 'pending') {
          showView('pending');
        } else if (status === 'rejected') {
          showView('rejected');
        } else {
          showView('payment');
        }
        
        // Button event listeners
        checkStatusBtn?.addEventListener('click', () => {
          window.location.reload();
        });
        
        tryAgainBtn?.addEventListener('click', () => {
          showView('payment');
        });
        
        const contactSupport = (e) => {
          e.preventDefault();
          window.location.href = 'contact.html';
        };
        
        contactSupportBtn?.addEventListener('click', contactSupport);
        contactSupportBtn2?.addEventListener('click', contactSupport);
        
        // Hide QR container and payment status by default
        qrContainer.style.display = 'none';
        paymentStatus.style.display = 'none';
      }

      // Cancel payment button
      cancelPaymentBtn.addEventListener('click', () => {
        sessionStorage.removeItem('currentPaymentRef');
        qrContainer.style.display = 'none';
        subscribeBtn.style.display = 'block';
        paymentStatus.style.display = 'none';
      });

      // Start the page setup
      setupPage();
    }
  </script>
</body>
</html>
